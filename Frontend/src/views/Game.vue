<template>
    <ModalApp :show="showModal">
        <div v-if="isEnd">
            End game! result: WINNER:
            {{
                currentGame.result
                    ? currentGame.host.firstName
                    : currenctGame.guest.firstName
            }}
            <router-link
                class="block w-full py-1 px-2 mt-5 bg-cgreen text-white"
                v-if="isEnd"
                :to="{ name: 'listGames' }"
            >
                <span>Back to lobby!</span>
            </router-link>
        </div>
        <div v-else>
            {{ ModalValue }}
            <button
                class="block w-full py-1 px-2 mt-5 bg-cgreen text-white"
                v-if="!isFullLobby"
                @click="copy(link)"
            >
                <span v-if="!copied">Copy</span>
                <span v-else>Copied!</span>
            </button>
        </div>
    </ModalApp>

    <div class="dark:bg-dark min-h-screen dark:text-light">
        <div class="container p-10 mx-auto">
            <h1 class="text-4xl font-bold dark:text-light text-light mb-6">
                Game #{{ id }}
            </h1>
            <div class="text-lg font-semibold text-center mb-12">
                Score Limit:5
            </div>
            <div>
                <div
                    v-if="currentGame"
                    class="grid grid-cols-2 dark:bg-dark mb-6 border-2 p-6 shadow-lg shadow-black rounded-md"
                >
                    <div class="flex flex-col items-center">
                        <p
                            v-if="currentGame.host"
                            class="text-lg font-semibold"
                        >
                            HOST {{ currentGame.host.firstName }} score:
                        </p>
                        <p class="text-5xl font-semibold">
                            {{ currentGame.hostScore }}
                        </p>
                    </div>
                    <div class="flex flex-col items-center">
                        <p
                            v-if="currentGame.guest"
                            class="text-lg font-semibold"
                        >
                            {{ currentGame.guest.firstName }} Score:
                        </p>
                        <p class="text-5xl font-semibold">
                            {{ currentGame.guestScore }}
                        </p>
                    </div>
                </div>
                <div
                    class="grid grid-cols-3 divide-x items-center justify-center dark:bg-dark mb-6 border-2 shadow-lg shadow-black rounded-md"
                >
                    <label for="rock" class="flex flex-col items-center h-full">
                        <div
                            class="w-44 p-4 m-auto"
                            :class="
                                type == 'Rock'
                                    ? 'border-2 rounded-xl border-light '
                                    : null
                            "
                        >
                            <svg
                                width="100%"
                                height="100%"
                                viewBox="0 0 272 291"
                                fill="none"
                                xmlns="http://www.w3.org/2000/svg"
                            >
                                <path
                                    d="M9 165.59V133C10.8238 134.991 12.8821 136.754 15.13 138.25V126.71C11.1783 122.239 8.99804 116.477 9 110.51V72.66C8.9955 67.9333 10.3567 63.306 12.9199 59.3346C15.483 55.3632 19.139 52.217 23.448 50.2743C27.757 48.3316 32.5356 47.6752 37.2088 48.3841C41.882 49.0929 46.2509 51.1369 49.79 54.27C55.8801 54.5091 61.785 56.4301 66.85 59.82V35.28C66.8452 30.2503 68.2779 25.324 70.9792 21.0813C73.6806 16.8386 77.5382 13.4563 82.0976 11.3326C86.6569 9.20898 91.7282 8.43247 96.7141 9.09462C101.7 9.75676 106.393 11.83 110.24 15.07C118.004 15.5333 125.393 18.5698 131.24 23.7C133.037 20.0928 135.627 16.9389 138.816 14.4743C142.004 12.0096 145.709 10.2982 149.653 9.46812C153.596 8.63803 157.677 8.71075 161.588 9.68086C165.5 10.651 169.141 12.4933 172.24 15.07C179.885 15.5405 187.171 18.4813 193 23.45C194.537 20.3595 196.779 17.6738 199.546 15.6102C202.313 13.5466 205.526 12.1629 208.926 11.5711C212.327 10.9792 215.819 11.1957 219.12 12.203C222.421 13.2104 225.439 14.9805 227.93 17.37C232.304 17.4154 236.617 18.3975 240.58 20.25C238.195 15.1414 234.452 10.7864 229.76 7.66084C225.068 4.53529 219.607 2.75939 213.974 2.52717C208.341 2.29496 202.753 3.61535 197.819 6.3441C192.886 9.07285 188.797 13.105 186 18C182.876 12.5316 178.352 7.9934 172.894 4.85148C167.435 1.70957 161.239 0.0771959 154.941 0.121991C148.643 0.166787 142.471 1.88715 137.058 5.1064C131.645 8.32564 127.186 12.9277 124.14 18.44C120.392 11.5946 114.473 6.19075 107.316 3.07976C100.158 -0.0312388 92.1693 -0.672512 84.6073 1.25694C77.0453 3.18639 70.3402 7.57692 65.5483 13.7368C60.7564 19.8967 58.1501 27.4758 58.14 35.28V50.18C53.61 45.2292 47.6895 41.7631 41.155 40.2362C34.6205 38.7092 27.7771 39.1927 21.5222 41.6233C15.2673 44.0539 9.89302 48.3181 6.10411 53.8566C2.3152 59.3952 0.288559 65.9495 0.289994 72.66V165.59C0.292437 181.841 3.89191 197.891 10.8301 212.587C17.7683 227.283 27.8733 240.261 40.42 250.59C30.4881 238.586 23.2147 224.612 19.08 209.59C12.4406 195.873 8.9944 180.83 9 165.59Z"
                                    fill="#FF30D6"
                                />
                                <path
                                    d="M267.84 139.23C265.604 133.261 262.386 127.708 258.32 122.8V48.13C258.312 42.2749 256.637 36.5431 253.49 31.6056C250.343 26.6681 245.854 22.7292 240.55 20.25C242.455 24.3188 243.442 28.7571 243.44 33.25V107.92C251.937 118.159 256.592 131.044 256.6 144.35V144.35C256.6 216.83 197.6 275.8 125.15 275.8H110.51C84.8927 275.822 60.0739 266.887 40.35 250.54C50.6786 263.087 63.6566 273.193 78.3527 280.131C93.0487 287.069 109.098 290.668 125.35 290.67H140C212.48 290.67 271.44 231.67 271.44 159.22C271.449 152.395 270.229 145.623 267.84 139.23V139.23Z"
                                    fill="#45E9FF"
                                />
                                <path
                                    d="M15.1 87.53V126.71C18.3883 130.472 22.7472 133.141 27.5934 134.358C32.4397 135.576 37.5422 135.284 42.2182 133.523C46.8942 131.761 50.9207 128.613 53.7589 124.501C56.5972 120.388 58.1117 115.507 58.1 110.51V72.66C58.1034 69.1798 57.3639 65.7391 55.9308 62.5677C54.4977 59.3963 52.4041 56.5673 49.79 54.27C49.34 54.27 48.89 54.27 48.43 54.27C39.6033 54.2726 31.1378 57.7754 24.8898 64.0103C18.6417 70.2452 15.1212 78.7033 15.1 87.53V87.53Z"
                                    fill="#45E9FF"
                                />
                                <path
                                    d="M19 209.58C27.2971 226.806 40.2834 241.343 56.4682 251.522C72.6529 261.702 91.3801 267.112 110.5 267.13H125.14C157.671 267.093 188.858 254.154 211.861 231.151C234.864 208.148 247.803 176.961 247.84 144.43V144.43C247.835 131.582 242.726 119.262 233.639 110.18C224.551 101.098 212.228 95.9973 199.38 96H72.8C71.2087 96 69.6826 96.6321 68.5574 97.7574C67.4321 98.8826 66.8 100.409 66.8 102V108.47C66.8132 119.47 71.1888 130.015 78.9668 137.793C86.7448 145.571 97.2902 149.947 108.29 149.96H171.1V158.71H170.38C158.029 158.723 146.187 163.636 137.454 172.371C128.721 181.106 123.811 192.949 123.8 205.3V220.3H115.05V205.23C115.052 195.949 117.388 186.817 121.844 178.675C126.3 170.534 132.733 163.644 140.55 158.64H108.31C98.4136 158.623 88.7419 155.688 80.5049 150.203C72.2678 144.717 65.8311 136.925 62 127.8C59.6741 131.636 56.596 134.962 52.951 137.577C49.3061 140.192 45.1696 142.042 40.7907 143.017C36.4118 143.991 31.881 144.069 27.471 143.247C23.061 142.424 18.8631 140.718 15.13 138.23V180.46C15.1141 190.296 16.4156 200.09 19 209.58V209.58Z"
                                    fill="#45E9FF"
                                />
                                <path
                                    d="M200.84 32.87C198.778 29.301 196.115 26.1144 192.97 23.45C191.442 26.4908 190.648 29.847 190.65 33.25V87.25H199.38C212.189 87.2403 224.627 91.545 234.69 99.47V33.25C234.688 30.2819 234.085 27.3449 232.918 24.6158C231.752 21.8868 230.044 19.422 227.9 17.37H227.55C222.127 17.3717 216.801 18.806 212.11 21.5279C207.42 24.2498 203.532 28.1625 200.84 32.87V32.87Z"
                                    fill="#45E9FF"
                                />
                                <path
                                    d="M139 33.31C137 29.677 134.377 26.4241 131.25 23.7C129.393 27.399 128.427 31.4811 128.43 35.62V87.21H181.93V35.62C181.932 31.6968 181.069 27.8214 179.403 24.2696C177.736 20.7178 175.308 17.5767 172.29 15.07C171.55 15.07 170.81 15 170.06 15C163.72 15.0032 157.496 16.7028 152.035 19.9225C146.573 23.1421 142.073 27.7644 139 33.31V33.31Z"
                                    fill="#45E9FF"
                                />
                                <path
                                    d="M73 50.16V65.06C71.1786 63.0693 69.1199 61.3095 66.87 59.82V72.66V88.47C68.7595 87.6338 70.8038 87.2045 72.87 87.21H119.72V35.28C119.72 31.4259 118.875 27.6187 117.244 24.1268C115.613 20.6349 113.236 17.5433 110.28 15.07C109.59 15.07 108.89 15 108.18 15C98.8548 15.0053 89.9127 18.7107 83.3169 25.3028C76.7211 31.8948 73.0106 40.8348 73 50.16Z"
                                    fill="#45E9FF"
                                />
                                <path
                                    d="M125.15 275.88C197.63 275.88 256.6 216.88 256.6 144.43C256.592 131.124 251.937 118.239 243.44 108V33.25C243.442 28.7571 242.455 24.3188 240.55 20.25C236.587 18.3975 232.274 17.4154 227.9 17.37C230.044 19.422 231.752 21.8868 232.918 24.6158C234.085 27.3449 234.688 30.2819 234.69 33.25V99.43C224.627 91.505 212.189 87.2003 199.38 87.21H190.65V33.21C190.648 29.807 191.442 26.4508 192.97 23.41C187.154 18.4513 179.888 15.5111 172.26 15.03C175.278 17.5367 177.706 20.6778 179.372 24.2296C181.039 27.7814 181.902 31.6568 181.9 35.58V87.17H128.4V35.62C128.397 31.4811 129.363 27.399 131.22 23.7C125.373 18.5698 117.984 15.5333 110.22 15.07C113.176 17.5433 115.553 20.6349 117.184 24.1268C118.815 27.6187 119.66 31.4259 119.66 35.28V87.21H72.8C70.7338 87.2045 68.6895 87.6338 66.8 88.47V72.66V59.82C61.735 56.4301 55.8301 54.5091 49.74 54.27C52.3542 56.5673 54.4477 59.3963 55.8808 62.5677C57.3139 65.7391 58.0534 69.1798 58.05 72.66V110.51C58.0617 115.507 56.5472 120.388 53.7089 124.501C50.8707 128.613 46.8442 131.761 42.1682 133.523C37.4922 135.284 32.3897 135.576 27.5434 134.358C22.6972 133.141 18.3383 130.472 15.05 126.71V138.23C18.7859 140.731 22.9901 142.448 27.4084 143.277C31.8267 144.107 36.3674 144.032 40.7559 143.057C45.1445 142.082 49.2898 140.228 52.9412 137.605C56.5926 134.983 59.6743 131.647 62 127.8C65.8331 136.929 72.2744 144.725 80.5174 150.211C88.7603 155.697 98.4385 158.629 108.34 158.64H140.6C132.783 163.644 126.35 170.534 121.894 178.675C117.438 186.817 115.102 195.949 115.1 205.23V220.3H123.85V205.23C123.861 192.879 128.771 181.036 137.504 172.301C146.237 163.566 158.079 158.653 170.43 158.64H171.15V149.89H108.31C97.3102 149.877 86.7648 145.501 78.9868 137.723C71.2087 129.945 66.8332 119.4 66.82 108.4V101.93C66.82 100.339 67.4521 98.8126 68.5774 97.6873C69.7026 96.5621 71.2287 95.93 72.82 95.93H199.38C212.212 95.9247 224.523 101.01 233.61 110.071C242.697 119.132 247.818 131.428 247.85 144.26V144.26C247.813 176.791 234.874 207.978 211.871 230.981C188.868 253.984 157.681 266.923 125.15 266.96H110.51C91.4066 266.959 72.6899 261.576 56.505 251.427C40.3202 241.279 27.3219 226.776 19 209.58C23.1347 224.602 30.4081 238.576 40.34 250.58C60.0639 266.927 84.8827 275.862 110.5 275.84L125.15 275.88Z"
                                    fill="#452CD6"
                                />
                            </svg>
                        </div>
                        <input
                            type="radio"
                            id="rock"
                            value="Rock"
                            v-model="type"
                            class="opacity-0 h-0 w-0"
                        />
                    </label>
                    <label
                        for="paper"
                        class="flex flex-col items-center h-full"
                    >
                        <div
                            class="w-44 p-4 m-auto"
                            :class="
                                type == 'Paper'
                                    ? 'border-2 rounded-xl border-light '
                                    : null
                            "
                        >
                            <svg
                                width="100%"
                                height="100%"
                                viewBox="0 0 301 364"
                                fill="none"
                                xmlns="http://www.w3.org/2000/svg"
                            >
                                <path
                                    d="M284.46 196.76C275.987 188.268 264.531 183.423 252.536 183.257C240.541 183.09 228.956 187.617 220.25 195.87L218.25 197.72V209.72L226.25 202.25C233.307 195.579 242.686 191.923 252.396 192.057C262.106 192.192 271.381 196.107 278.25 202.97C278.747 203.465 279.187 204.015 279.56 204.61C283.183 205.768 286.628 207.421 289.8 209.52C289.775 204.728 287.855 200.141 284.46 196.76V196.76Z"
                                    fill="#FF30D6"
                                />
                                <path
                                    d="M178.23 26.51C172.653 26.5023 167.19 28.0841 162.48 31.07C164.204 33.4758 165.553 36.1293 166.48 38.94C168.843 37.2925 171.527 36.1615 174.357 35.621C177.187 35.0805 180.099 35.1425 182.903 35.803C185.707 36.4635 188.341 37.7076 190.632 39.4543C192.923 41.2009 194.82 43.4109 196.2 45.94C200.084 46.4026 203.796 47.8104 207.01 50.04C203.88 36.39 192.37 26.51 178.23 26.51Z"
                                    fill="#FF30D6"
                                />
                                <path
                                    d="M126.18 0.630004C120.901 0.631481 115.708 1.97035 111.086 4.52167C106.465 7.07299 102.564 10.7536 99.75 15.22C98.5616 13.1349 97.1171 11.2066 95.45 9.48001C92.6826 6.63572 89.3652 4.38431 85.7 2.86285C82.0347 1.3414 78.0982 0.581709 74.13 0.630004C66.2927 0.637946 58.7786 3.75484 53.2367 9.29669C47.6949 14.8385 44.578 22.3526 44.57 30.19V53C39.7197 48.6119 33.4107 46.1845 26.87 46.19C12.04 46.19 0.42 58.19 0.42 73.53V254.72C0.397115 272.967 5.43128 290.863 14.9636 306.422C24.4959 321.98 38.1534 334.593 54.42 342.86C44.1273 334.463 35.7182 323.992 29.74 312.13C16.4004 295.974 9.11515 275.671 9.14003 254.72V73.54C9.14003 64.54 15.35 54.95 26.84 54.95C30.2654 54.9574 33.6151 55.9579 36.4833 57.8304C39.3515 59.703 41.6152 62.3671 43 65.5C46.6424 65.7029 50.1762 66.8132 53.28 68.73V30.19C53.2853 24.6725 55.4795 19.3824 59.381 15.481C63.2825 11.5795 68.5725 9.3853 74.09 9.38C76.8777 9.33989 79.6444 9.86605 82.2228 10.9266C84.8011 11.9872 87.1374 13.56 89.09 15.55C90.3907 16.9059 91.4947 18.4375 92.37 20.1C96.8487 20.6334 101.096 22.3834 104.65 25.16C105.904 21.0347 108.328 17.3618 111.628 14.5862C114.927 11.8107 118.961 10.0518 123.24 9.52258C127.519 8.99338 131.86 9.71665 135.737 11.6047C139.613 13.4928 142.859 16.4646 145.08 20.16C149.118 20.7713 152.949 22.3456 156.25 24.75C154.93 19.5641 152.397 14.7659 148.86 10.75C146.017 7.54724 142.523 4.98787 138.612 3.24274C134.701 1.4976 130.463 0.606865 126.18 0.630004Z"
                                    fill="#FF30D6"
                                />
                                <path
                                    d="M207.79 207.59L218.29 197.72V72.29C218.32 67.9509 217.311 63.6677 215.347 59.7985C213.382 55.9293 210.52 52.5867 207 50.05C207.544 52.4655 207.819 54.9339 207.82 57.41L207.79 207.59Z"
                                    fill="#45E9FF"
                                />
                                <path
                                    d="M203.42 297.64L278.58 216.1C279.993 214.565 280.858 212.604 281.039 210.525C281.22 208.447 280.707 206.366 279.58 204.61C272.464 202.312 264.863 201.965 257.567 203.604C250.271 205.243 243.549 208.809 238.1 213.93L218.27 232.58V209.72L206.39 220.89C205.573 221.646 204.503 222.071 203.39 222.08H152.39C144.318 222.077 136.34 223.815 129.001 227.175C121.661 230.535 115.133 235.438 109.86 241.55L103.24 235.83C109.334 228.768 116.879 223.102 125.361 219.219C133.843 215.337 143.062 213.328 152.39 213.33H199V57.41C199.052 53.4256 198.073 49.4954 196.16 46C192.62 45.5617 189.027 45.8815 185.62 46.9381C182.213 47.9947 179.07 49.7639 176.399 52.1283C173.729 54.4927 171.591 57.3982 170.129 60.6519C168.667 63.9055 167.914 67.433 167.92 71V48.18C167.914 45.0414 167.415 41.9234 166.44 38.94C163.662 40.8505 161.391 43.4084 159.823 46.3929C158.255 49.3774 157.437 52.6987 157.44 56.07V159.07H148.69V33.3C148.754 28.6883 147.535 24.1495 145.17 20.19C143.816 19.984 142.449 19.8804 141.08 19.88C137.553 19.88 134.06 20.5747 130.801 21.9246C127.542 23.2744 124.581 25.2529 122.087 27.7471C119.593 30.2413 117.614 33.2023 116.265 36.4611C114.915 39.7199 114.22 43.2127 114.22 46.74V45.14C114.258 41.306 113.424 37.5135 111.782 34.0488C110.14 30.5842 107.732 27.5379 104.74 25.14C104.071 27.3101 103.733 29.569 103.74 31.84V159.05H94.99V30.26C95.0029 26.7183 94.1407 23.2282 92.48 20.1C91.3423 19.9551 90.1968 19.8816 89.05 19.88C82.3718 19.88 75.9672 22.5329 71.245 27.2551C66.5229 31.9772 63.87 38.3818 63.87 45.06V87.53C63.8719 83.7603 62.9078 80.053 61.0697 76.7618C59.2315 73.4706 56.5806 70.7054 53.37 68.73V159.05H44.62V72.65C44.593 70.1788 44.0408 67.7415 43 65.5C42.57 65.5 42.14 65.45 41.71 65.45C28.47 65.45 19.63 76.3 19.63 88.45V269.59C19.6163 284.366 23.076 298.937 29.73 312.13C38.0072 322.239 48.4239 330.385 60.2293 335.983C72.0347 341.58 84.9348 344.489 98 344.5C142.86 344.5 173.39 330.92 203.42 297.64Z"
                                    fill="#45E9FF"
                                />
                                <path
                                    d="M296.25 214.74C294.288 212.796 292.141 211.048 289.84 209.52C289.877 214.145 288.145 218.609 285 222L209.88 303.5C194.47 320.58 179.48 332.25 162.73 340.18C144.19 348.95 123.03 353.18 98.02 353.18C82.8778 353.197 67.9456 349.637 54.44 342.79C70.9176 356.31 91.5759 363.693 112.89 363.68C163.35 363.68 193.79 346.13 221.54 315.37L296.66 233.87C299.068 231.242 300.37 227.786 300.293 224.223C300.217 220.659 298.769 217.262 296.25 214.74V214.74Z"
                                    fill="#45E9FF"
                                />
                                <path
                                    d="M157.41 35.09C158.95 33.5768 160.65 32.2355 162.48 31.09C160.78 28.6707 158.696 26.5459 156.31 24.8C157.035 27.5821 157.405 30.4449 157.41 33.32V35.09Z"
                                    fill="#45E9FF"
                                />
                                <path
                                    d="M94.94 159.05H103.69V31.86C103.683 29.589 104.021 27.3301 104.69 25.16C101.136 22.3834 96.8886 20.6334 92.41 20.1C94.0707 23.2282 94.9329 26.7183 94.92 30.26L94.94 159.05Z"
                                    fill="#452CD6"
                                />
                                <path
                                    d="M44.57 159.05H53.32V68.73C50.2044 66.8068 46.6561 65.6963 43 65.5C44.0098 67.7484 44.5313 70.1853 44.53 72.65L44.57 159.05Z"
                                    fill="#452CD6"
                                />
                                <path
                                    d="M148.66 159.05H157.41V56.05C157.407 52.6787 158.225 49.3573 159.793 46.3729C161.361 43.3884 163.632 40.8305 166.41 38.92C165.483 36.1094 164.134 33.4558 162.41 31.05C160.58 32.1955 158.88 33.5368 157.34 35.05V33.3C157.335 30.4249 156.965 27.5621 156.24 24.78C152.939 22.3756 149.108 20.8013 145.07 20.19C147.435 24.1495 148.654 28.6883 148.59 33.3L148.66 159.05Z"
                                    fill="#452CD6"
                                />
                                <path
                                    d="M279.6 204.61C280.727 206.366 281.24 208.447 281.059 210.525C280.878 212.604 280.013 214.565 278.6 216.1L203.44 297.64C173.44 330.92 142.88 344.5 98.05 344.5C84.9865 344.488 72.0883 341.578 60.2848 335.981C48.4812 330.383 38.0661 322.237 29.79 312.13C35.7681 323.992 44.1772 334.463 54.47 342.86C67.9605 349.7 82.8747 353.259 98 353.25C123 353.25 144.17 348.98 162.71 340.25C179.46 332.32 194.45 320.65 209.86 303.57L285 222C288.149 218.6 289.877 214.124 289.83 209.49C286.66 207.402 283.218 205.76 279.6 204.61V204.61Z"
                                    fill="#452CD6"
                                />
                                <path
                                    d="M109.84 241.55C115.113 235.438 121.641 230.535 128.981 227.175C136.32 223.815 144.298 222.077 152.37 222.08H203.37C204.483 222.071 205.553 221.646 206.37 220.89L218.25 209.72V197.72L207.75 207.59V57.41C207.749 54.9339 207.474 52.4655 206.93 50.05C203.716 47.8203 200.004 46.4126 196.12 45.95C198.056 49.4564 199.048 53.4051 199 57.41V213.33H152.37C143.042 213.328 133.823 215.337 125.341 219.219C116.859 223.102 109.314 228.768 103.22 235.83L109.84 241.55Z"
                                    fill="#452CD6"
                                />
                            </svg>
                        </div>
                        <input
                            type="radio"
                            id="paper"
                            value="Paper"
                            v-model="type"
                            class="opacity-0 h-0 w-0"
                        />
                    </label>
                    <label
                        for="Scissor"
                        class="flex flex-col items-center h-full"
                    >
                        <div
                            class="w-44 p-4 m-auto"
                            :class="
                                type == 'Scissors'
                                    ? 'border-2 rounded-xl border-light '
                                    : null
                            "
                        >
                            <svg
                                width="100%"
                                height="100%"
                                viewBox="0 0 250 382"
                                fill="none"
                                xmlns="http://www.w3.org/2000/svg"
                            >
                                <path
                                    d="M243.76 27C240.758 23.0004 236.796 19.8225 232.24 17.76C234.58 22.9094 235.399 28.6205 234.6 34.22C229.01 75.97 224.77 105.79 221.67 127.56C212.31 193.37 212.31 193.37 212.31 258.16C212.31 289.62 200.42 318.1 178.82 338.35C159.122 356.696 133.198 366.888 106.28 366.87C104 366.87 101.717 366.793 99.4301 366.64C77.9648 365.23 57.4906 357.087 40.92 343.37C41.84 344.48 42.77 345.58 43.73 346.66C62.22 367.39 87.29 379.77 114.3 381.52C116.59 381.67 118.87 381.74 121.16 381.74C148.078 381.756 174.001 371.564 193.7 353.22C215.29 332.98 227.19 304.5 227.19 273.03C227.19 208.25 227.19 208.25 236.55 142.44C239.64 120.67 243.89 90.85 249.48 49.09C250.036 45.2126 249.817 41.2634 248.835 37.4714C247.853 33.6795 246.128 30.1202 243.76 27V27Z"
                                    fill="#45E9FF"
                                />
                                <path
                                    d="M112.66 142.86C115.888 147.901 117.599 153.764 117.59 159.75V201H155.13C164.83 201.005 174.37 203.477 182.852 208.182C191.334 212.888 198.481 219.673 203.62 227.9C203.88 190.52 205.3 180.55 213.01 126.35C216.1 104.59 220.34 74.79 225.94 33.05C226.392 29.799 226.08 26.4874 225.028 23.3782C223.976 20.2691 222.214 17.4483 219.88 15.14C212.706 15.1582 205.778 17.7614 200.368 22.4724C194.957 27.1833 191.425 33.6866 190.42 40.79L174.42 150.23L170.32 122.07L163.87 166.34C163.712 167.375 163.189 168.32 162.394 169.002C161.6 169.685 160.587 170.06 159.54 170.06C158.493 170.06 157.48 169.685 156.686 169.002C155.891 168.32 155.368 167.375 155.21 166.34L135.02 27.59C134.374 23.0327 132.244 18.8152 128.96 15.59C124.694 15.593 120.478 16.5122 116.598 18.2855C112.718 20.0588 109.264 22.6447 106.47 25.8683C103.676 29.092 101.607 32.8782 100.403 36.9707C99.1984 41.0633 98.8871 45.3668 99.49 49.59L112.66 142.86Z"
                                    fill="#45E9FF"
                                />
                                <path
                                    d="M32 239.91C37.5172 239.902 42.8432 237.888 46.9849 234.243C51.1266 230.598 53.8013 225.571 54.51 220.1C54.51 219.85 54.51 219.6 54.51 219.36C54.5075 218.48 54.571 217.601 54.7 216.73V184.18C54.7006 181.077 54.0625 178.008 52.8256 175.162C51.5886 172.317 49.7792 169.756 47.51 167.64H46.89C38.5575 167.651 30.5693 170.965 24.6773 176.857C18.7853 182.749 15.4706 190.738 15.46 199.07V232.7C17.5743 234.973 20.134 236.786 22.9796 238.026C25.8252 239.267 28.8958 239.908 32 239.91V239.91Z"
                                    fill="#45E9FF"
                                />
                                <path
                                    d="M172.84 332C192.65 313.43 203.56 287.22 203.56 258.2C203.547 245.36 198.44 233.049 189.361 223.969C180.281 214.89 167.97 209.783 155.13 209.77H72.91C70.6877 209.772 68.5345 210.544 66.8158 211.952C65.0971 213.361 63.9185 215.321 63.48 217.5C63.48 218.5 63.4101 219.5 63.3101 220.5C63.6133 229.427 67.37 237.888 73.789 244.1C80.2079 250.312 88.7875 253.79 97.72 253.8H139.23V262.55C128.413 262.563 118.043 266.866 110.395 274.515C102.746 282.163 98.4433 292.533 98.4301 303.35V316.7H89.6801V303.34C89.6814 295.309 91.6354 287.399 95.3739 280.291C99.1124 273.183 104.523 267.091 111.14 262.54H97.72C89.0995 262.53 80.6785 259.945 73.5372 255.117C66.396 250.288 60.8602 243.436 57.64 235.44C53.0169 241.957 46.0812 246.464 38.2483 248.042C30.4154 249.62 22.2756 248.149 15.49 243.93V272.43C15.4851 282.451 16.8305 292.428 19.49 302.09C23.6405 310.758 28.9933 318.797 35.39 325.97C52.39 344.97 75.28 356.32 99.99 357.92C113.258 358.789 126.564 356.938 139.091 352.48C151.618 348.023 163.102 341.054 172.84 332V332Z"
                                    fill="#45E9FF"
                                />
                                <path
                                    d="M159.59 135.34L165.95 91.71L158.6 41.21C157.897 36.2355 155.949 31.5191 152.937 27.4984C149.925 23.4776 145.946 20.2826 141.37 18.21C142.536 20.7951 143.331 23.5322 143.73 26.34L159.59 135.34Z"
                                    fill="#45E9FF"
                                />
                                <path
                                    d="M108.84 201V159.75C108.842 156.646 108.205 153.574 106.968 150.727C105.731 147.879 103.92 145.317 101.65 143.2H101C92.6658 143.208 84.675 146.522 78.7809 152.414C72.8867 158.306 69.5706 166.296 69.5601 174.63V177.32C67.7332 175.408 65.6776 173.729 63.4399 172.32V203.6C66.2865 201.886 69.5475 200.984 72.87 200.99L108.84 201Z"
                                    fill="#45E9FF"
                                />
                                <path
                                    d="M232.24 17.77C231.331 15.7742 230.208 13.8831 228.89 12.13C225.342 7.41846 220.477 3.86485 214.909 1.91855C209.341 -0.0277414 203.322 -0.279298 197.611 1.19571C191.9 2.67073 186.756 5.80605 182.827 10.2052C178.898 14.6043 176.362 20.0696 175.54 25.91L165.95 91.71L159.59 135.34L143.73 26.34C142.613 18.509 138.433 11.4417 132.109 6.69043C125.784 1.93917 117.832 -0.107496 110 1C102.169 2.10554 95.0963 6.27499 90.3373 12.5922C85.5783 18.9093 83.5219 26.8575 84.62 34.69L98.12 130.74C94.3424 129.18 90.2969 128.372 86.21 128.36H86.12C77.7858 128.371 69.7961 131.687 63.9038 137.581C58.0116 143.475 54.6979 151.466 54.69 159.8V162.49C50.3518 157.957 44.7558 154.826 38.6227 153.502C32.4896 152.177 26.1005 152.719 20.2782 155.058C14.4559 157.397 9.46722 161.425 5.95472 166.625C2.44221 171.824 0.56679 177.956 0.570012 184.23V257.61C0.540176 284.985 10.5974 311.411 28.82 331.84C32.5367 336.007 36.5686 339.882 40.88 343.43C57.4507 357.147 77.9248 365.29 99.39 366.7C101.677 366.853 103.96 366.93 106.24 366.93C133.158 366.948 159.082 356.756 178.78 338.41C200.38 318.16 212.27 289.68 212.27 258.22C212.27 193.43 212.27 193.43 221.63 127.62C224.73 105.85 228.97 76.03 234.56 34.28C235.381 28.668 234.576 22.9383 232.24 17.77ZM63.48 159.77C63.4853 153.756 65.8762 147.989 70.1281 143.735C74.38 139.481 80.1456 137.088 86.16 137.08H86.22C90.307 137.092 94.315 138.208 97.82 140.31C99.1942 141.144 100.478 142.12 101.65 143.22C103.92 145.337 105.731 147.899 106.968 150.747C108.205 153.594 108.842 156.666 108.84 159.77V201H72.91C69.5875 200.994 66.3265 201.896 63.48 203.61V159.75V159.77ZM9.35999 184.2C9.48458 178.266 11.9294 172.617 16.17 168.465C20.4107 164.312 26.1097 161.986 32.045 161.986C37.9803 161.986 43.6793 164.312 47.92 168.465C52.1607 172.617 54.6054 178.266 54.73 184.2V216.75C54.601 217.621 54.5375 218.5 54.54 219.38C54.54 219.62 54.54 219.87 54.54 220.12C53.7963 225.831 50.9087 231.046 46.4626 234.707C42.0164 238.367 36.3445 240.201 30.5968 239.834C24.8491 239.468 19.4558 236.93 15.5104 232.734C11.5649 228.538 9.36262 222.999 9.34998 217.24L9.35999 184.2ZM172.84 332C163.104 341.053 151.621 348.021 139.095 352.478C126.57 356.936 113.266 358.787 100 357.92C75.29 356.32 52.35 344.97 35.4 325.97C18.6407 307.125 9.38804 282.779 9.40003 257.56V239C11.226 240.917 13.2855 242.597 15.53 244C22.3156 248.219 30.4553 249.69 38.2883 248.112C46.1212 246.534 53.0569 242.027 57.68 235.51C60.9002 243.506 66.436 250.358 73.5773 255.187C80.7185 260.015 89.1396 262.6 97.76 262.61H111.18C104.563 267.161 99.1525 273.253 95.4139 280.361C91.6754 287.469 89.7213 295.379 89.72 303.41V316.7H98.47V303.34C98.4832 292.523 102.786 282.153 110.435 274.505C118.083 266.856 128.453 262.553 139.27 262.54V253.79H97.76C88.8275 253.78 80.2479 250.302 73.829 244.09C67.4101 237.878 63.6532 229.417 63.35 220.49C63.45 219.49 63.51 218.49 63.52 217.49C63.9585 215.311 65.137 213.351 66.8557 211.942C68.5745 210.534 70.7276 209.762 72.95 209.76H155.17C168.01 209.773 180.321 214.88 189.401 223.959C198.48 233.039 203.587 245.35 203.6 258.19C203.56 287.19 192.65 313.4 172.84 332ZM225.94 33C220.34 74.74 216.1 104.54 213.01 126.3C205.3 180.5 203.88 190.47 203.62 227.85C198.481 219.623 191.334 212.838 182.852 208.132C174.37 203.427 164.83 200.955 155.13 200.95H117.59V159.75C117.599 153.764 115.888 147.901 112.66 142.86C111.306 140.744 109.704 138.797 107.89 137.06L93.33 33.42C92.5555 27.8849 94.0117 22.2689 97.3779 17.8074C100.744 13.3459 105.745 10.4044 111.28 9.63001C116.815 8.85558 122.431 10.3116 126.893 13.6779C131.354 17.0442 134.296 22.0449 135.07 27.58L155.26 166.33C155.418 167.365 155.941 168.31 156.736 168.992C157.53 169.675 158.543 170.05 159.59 170.05C160.637 170.05 161.65 169.675 162.444 168.992C163.239 168.31 163.762 167.365 163.92 166.33L170.37 122.06L184.2 27.15C185.068 21.6918 188.045 16.7928 192.49 13.508C196.934 10.2232 202.491 8.81535 207.964 9.58759C213.436 10.3598 218.387 13.2504 221.749 17.6369C225.111 22.0233 226.616 27.5548 225.94 33.04V33Z"
                                    fill="#FF30D6"
                                />
                                <path
                                    d="M155.26 166.33C155.418 167.365 155.941 168.31 156.736 168.992C157.53 169.675 158.543 170.05 159.59 170.05C160.637 170.05 161.65 169.675 162.444 168.992C163.239 168.31 163.762 167.365 163.92 166.33L170.37 122.06L166 91.71L159.64 135.34L143.78 26.34C143.381 23.5322 142.586 20.7951 141.42 18.21C137.541 16.4399 133.324 15.5324 129.06 15.55C132.344 18.7752 134.474 22.9927 135.12 27.55L155.26 166.33Z"
                                    fill="#452CD6"
                                />
                                <path
                                    d="M232.24 17.77C228.354 16.0223 224.141 15.1223 219.88 15.13C222.214 17.4383 223.976 20.2591 225.028 23.3682C226.08 26.4773 226.392 29.7891 225.94 33.04C220.34 74.78 216.1 104.58 213.01 126.34C205.3 180.54 203.88 190.51 203.62 227.89C198.481 219.663 191.334 212.878 182.852 208.172C174.37 203.467 164.83 200.995 155.13 200.99H117.59V159.75C117.599 153.764 115.888 147.901 112.66 142.86L113.04 145.57C109.425 144.076 105.561 143.272 101.65 143.2C103.92 145.317 105.731 147.879 106.968 150.727C108.205 153.574 108.842 156.646 108.84 159.75V201H72.91C69.5875 200.994 66.3265 201.896 63.48 203.61V172.35C58.6899 169.368 53.1813 167.741 47.54 167.64C49.8092 169.756 51.6186 172.317 52.8555 175.162C54.0925 178.008 54.7305 181.077 54.73 184.18V216.73C54.601 217.601 54.5375 218.48 54.54 219.36C54.54 219.6 54.54 219.85 54.54 220.1C53.9989 224.373 52.2514 228.403 49.502 231.718C46.7526 235.034 43.1152 237.497 39.0162 238.819C34.9171 240.141 30.5261 240.268 26.3577 239.184C22.1892 238.101 18.4159 235.851 15.48 232.7V243.93C22.2656 248.149 30.4053 249.62 38.2383 248.042C46.0712 246.464 53.0069 241.957 57.63 235.44C60.8502 243.436 66.3861 250.288 73.5273 255.117C80.6686 259.945 89.0895 262.53 97.71 262.54H111.13C104.513 267.091 99.1024 273.183 95.3639 280.291C91.6254 287.399 89.6713 295.309 89.67 303.34V316.7H98.42V303.34C98.4333 292.523 102.736 282.153 110.385 274.505C118.033 266.856 128.403 262.553 139.22 262.54V253.79H97.71C88.7775 253.78 80.1978 250.302 73.7789 244.09C67.36 237.878 63.6032 229.417 63.3 220.49C63.4 219.49 63.46 218.49 63.47 217.49C63.9084 215.311 65.0871 213.351 66.8058 211.942C68.5245 210.534 70.6776 209.762 72.9 209.76H155.12C167.96 209.773 180.271 214.88 189.351 223.959C198.43 233.039 203.537 245.35 203.55 258.19C203.55 287.19 192.64 313.42 172.83 331.99C163.096 341.043 151.615 348.013 139.091 352.472C126.568 356.931 113.265 358.784 100 357.92C75.29 356.32 52.35 344.97 35.4 325.97C29.0033 318.797 23.6505 310.758 19.5 302.09C23.6487 317.212 30.9521 331.284 40.93 343.38C57.5006 357.097 77.9747 365.24 99.4399 366.65C101.727 366.803 104.01 366.88 106.29 366.88C133.208 366.898 159.132 356.706 178.83 338.36C200.43 318.11 212.32 289.63 212.32 258.17C212.32 193.38 212.32 193.38 221.68 127.57C224.78 105.8 229.02 75.98 234.61 34.23C235.406 28.6296 234.583 22.9184 232.24 17.77V17.77Z"
                                    fill="#452CD6"
                                />
                            </svg>
                        </div>
                        <input
                            type="radio"
                            id="Scissor"
                            value="Scissors"
                            v-model="type"
                            class="opacity-0 h-0 w-0"
                        />
                    </label>
                </div>
            </div>
        </div>
    </div>
</template>

<script>
import ModalApp from '@/components/ModalApp.vue';
import { useRoute, useRouter } from 'vue-router';
import {
    computed,
    ref,
    watch,
    onMounted,
    onBeforeMount,
    inject,
    reactive,
    toRefs,
} from 'vue';

import { HttpTransportType } from '@microsoft/signalr';
import { useApi } from '@/composables/useApi';
import { VueSignalR } from '@/modules/signalR/index';
import app from '@/main.js';
import { useGame } from '@/state/useGame';
import { useAuth } from '@/state/useAuth';
import { useClipboard } from '@vueuse/core';

export default {
    components: { ModalApp },
    name: 'game',
    setup() {
        const route = useRoute();
        const router = useRouter();
        const gameStore = useGame();
        const { user } = toRefs(useAuth());
        const { currentGame } = toRefs(gameStore);
        const id = computed(() => route.params.id || currentGame.value.id);
        const JoinGameApi = useApi('Game/JoinGame/' + id.value);
        const MakeMoveApi = useApi('Game/MakeMove/' + id.value);
        const showModal = ref(true);
        const link = ref(id.value);
        const { text, copy, copied, isSupported } = useClipboard(link);

        app.use(VueSignalR, {
            url: 'rockpaperscissorscdv.azurewebsites.net/',
            options: {},
            provider: 'game?token=' + id.value,
            withUrlOptions: {
                skipNegotiation: true,
                transport: HttpTransportType.WebSockets,
                withCredentials: false,
            },
        });

        const WsGame = inject('signalRGame');
        const type = ref('');
        const isJoin = computed(() => route.query.type === 'join');
        const isHost = computed(() => {
            return user.value.id === currentGame.value.hostId || false;
        });
        onBeforeMount(() => {
            gameStore.setCurrentGameId(id.value);
        });
        if (isJoin.value) {
            console.log('joinGame');
            JoinGameApi.post()
                .then(() => {
                    gameStore.setCurrentGame(JoinGameApi.data.value);
                    checkShowModal();
                })
                .catch((e) => {
                    router.push({ name: 'listGames' });
                });
        }
        onMounted(() => {});
        WsGame.on('ReceiveGameUpdate', (data) => {
            console.log('ReceiveGameUpdate');
            console.log(data);
            gameStore.setCurrentGame(data);
            checkShowModal();
        });
        const isFullLobby = computed(() => {
            return currentGame.value.guestId !== null;
        });
        const yourTurn = computed(() => {
            return currentGame.value.guestId;
        });
        const isSelected = computed(() => {
            if (isHost.value) return currentGame.value.hostTurnFinished;
            else return currentGame.value.guestTurnFinished;
        });
        const isEnd = computed(() => {
            if (!currentGame) return false;
            if (!currentGame.value.isActive) return true;
            else return false;
        });
        const checkShowModal = () => {
            if (!isFullLobby.value) showModal.value = true;
            else if (isFullLobby.value) showModal.value = false;
            else if (isSelected.value) showModal.value = true;
            else if (!isSelected.value) showModal.value = false;
            else return false;
        };
        watch(type, () => {
            console.log(type.value);
            const enums = ['Rock', 'Paper', 'Scissors'];

            if (type.value !== '') {
                MakeMoveApi.post(enums.indexOf(type.value)).then(() => {
                    type.value = '';
                });
            }
        });
        watch(isSelected, () => {
            console.log(isSelected.value, 'watch selected');
            showModal.value = isSelected.value;
        });
        watch(isEnd, () => {
            showModal.value = isEnd.value;
        });
        const nextTurn = computed(() => {
            return (
                currentGame.value.hostTurnFinished &&
                currentGame.value.guestTurnFinished
            );
        });
        const ModalValue = computed(() => {
            if (isEnd.value) return;
            if (!isFullLobby.value) return 'Game start when oponent will join.';
            if (isSelected.value) return 'Wait for oponent choose';

            return '';
        });
        return {
            id,
            type,
            isFullLobby,
            showModal,
            ModalValue,
            currentGame,
            yourTurn,
            nextTurn,
            isHost,
            user,
            isSelected,
            text,
            copy,
            copied,
            isSupported,
            link,
            isEnd,
        };
    },
};
</script>

<style></style>
